<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respostas - Violão Depois dos 40</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 5px;
        }
        .stat-label {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        .container {
            width: 100%;
            max-width: calc(100% - 20px);
            margin: 10px auto;
            box-sizing: border-box;
        }
        h1 {
            font-size: 32px;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(100, 181, 246, 0.3);
        }
        .table-container {
            display: block;
            position: relative;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            box-sizing: border-box;
            width: 100%;
            margin: 0;
            height: 600px;
            max-height: 600px;
            overflow: auto;

        }
        table::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        table::-webkit-scrollbar-thumb {
            background: rgba(100, 181, 246, 0.5);
            border-radius: 4px;
        }
        table::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 181, 246, 0.7);
        }
        table::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .table-container::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: rgba(100, 181, 246, 0.5);
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 181, 246, 0.7);
        }
        .table-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: transparent;
            border-radius: 10px;
            table-layout: auto;
            box-sizing: border-box;
        }


        th, td {
            padding: 15px 12px;
            text-align: left;
            vertical-align: top;
        }
        th:first-child { border-top-left-radius: 10px; }
        th:last-child { border-top-right-radius: 10px; }

        th:first-child, td:first-child {
            border-top-left-radius: 10px;
        }
        th:last-child, td:last-child {
            border-top-right-radius: 10px;
        }
        thead {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(45deg, #4caf50, #66bb6a) !important;
        }

        thead th {
            position: sticky;
            top: 0;
            z-index: 101;
        }

        thead th {
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #4caf50, #66bb6a) !important;
        }

        th {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            white-space: normal;
            word-break: keep-all;
            overflow-wrap: normal;
            hyphens: none;
            padding-right: 17px; /* 12px + 5px margem */
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        #responsesTable th,
        #responsesTable td {
            width: 10%; /* Distribuição uniforme para 10 colunas */
        }
        #responsesTable th:nth-child(7),
        #responsesTable td:nth-child(7) {
            width: 15%; /* Mais espaço para a coluna "Mais Informações" */
        }

        td {
            background: rgba(255,255,255,0.02);
            transition: all 0.3s ease;
            white-space: normal;
            word-break: keep-all;
            overflow-wrap: normal;
            hyphens: none;
            border-bottom: none;
        }

        
       
        tbody.student-group:hover .student-row td {
            background: rgba(255, 255, 255, 0.1);
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.1);
        }
        .response-group {
            margin-bottom: 15px;
        }
        .delete-btn {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .delete-btn:hover {
            background: linear-gradient(45deg, #ff3838, #ff2f2f);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4);
        }
        .ver-mais-row {
            cursor: pointer;
        }
        .ver-mais-row td {
            background: rgba(100, 181, 246, 0.1);
            text-align: center;
            color: #64b5f6;
            font-weight: bold;
            padding: 10px 15px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            transition: background 0.3s ease;
            border-radius: 0 0 10px 10px;
        }
        .ver-mais-row:hover td {
            background: rgba(100, 181, 246, 0.2);
        }
        .ver-mais-row td::before {
            content: '▼';
            display: inline-block;
            margin-right: 8px;
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        .ver-mais-row.active td::before {
            content: '▲';
            transform: rotate(180deg);
        }
        .ver-mais-row.active td {
            color: #ff4757;
        }
        
        .ver-mais:hover {
            background: rgba(255,255,255,0.1);
        }
        /* ===== TABELA DE DETALHES ===== */
        .details-row {
            display: none;
        }

        .details-row td {
            width: 100% !important;
            max-width: 100% !important;
            padding: 15px !important;
        }
        .details-row td > .details-table {
            padding: 0 !important;
        }
        .details-table {
            width: 100% !important;
            margin: 0 !important;
            table-layout: fixed !important;
            box-sizing: border-box;
            border: 2px solid rgb(41, 152, 255);
            border-collapse: separate;
            border-spacing: 0;
        }

        .details-table th,
        .details-table td {
            width: 12.5% !important;
            min-width: 12.5% !important;
            max-width: 12.5% !important;
            padding: 15px 12px;
            font-size: inherit;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            box-sizing: border-box;
            text-align: left;
            vertical-align: top;
        }

        .details-table th {
            white-space: normal;
            word-break: keep-all;
            overflow-wrap: normal;
            hyphens: none;
            padding: 15px 12px;
            background: linear-gradient(45deg, #1565c0, #1976d2);
            box-sizing: border-box;
        }

        .details-table thead {
            position: static !important;
            top: auto !important;
            z-index: auto !important;
        }

        .details-table thead th {
            position: static !important;
            top: auto !important;
            z-index: auto !important;
            background: linear-gradient(45deg, #1565c0, #1976d2) !important;
        }

        
        /* ===== FIM DA TABELA DE DETALHES ===== */
        
        .ver-tempos {
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            padding: 5px 12px;
            text-align: center;
            color: #64b5f6;
            font-size: 14px;
            margin-top: 10px;
            display: block;
            transition: background 0.3s ease;
        }
        .ver-tempos:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .tempos-container {
            display: none;
            margin-top: 10px;
            flex-wrap: wrap;
            gap: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        .tempo-box {
            background: rgba(255,255,255,0.15);
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            min-width: 100px;
            flex: 1 0 auto;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            
        }
        .tempo-box.total {
            background: #4c5c4d; /* Verde escuro */
        }
        .tempo-box.id {
            background: #5c5a4c; /* Marrom escuro */
        }
        .tempo-box.created {
            background: #564c5c; /* Azul escuro */
        }

        .copy-btn {
            background: none;
            border: none;
            color: #64b5f6;
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px;
            vertical-align: middle;
            transition: transform 0.2s ease;
        }
        .copy-btn:hover {
            transform: scale(1.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        .notification.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                margin: 5px;
                max-width: calc(100% - 10px);
            }
            .table-container {
                padding: 5px;
                margin: 0;
                width: 100%;
                max-width: 100%;
            }
            table, th, td {
                font-size: 11px;
                padding: 6px 3px;
            }
        
            .delete-btn {
                padding: 6px 12px;
                font-size: 11px;
            }
            .details-table {
                width: 100%;
                margin: 0;
            }
            .tempos-container {
                width: 100%;
            }
            .details-table th, .details-table td {
                font-size: 10px;
                padding: 6px 3px;
            }
            .tempo-box {
                min-width: 80px;
                font-size: 10px;
                padding: 6px;
            }
        
        }
        

        @media (max-width: 480px) {
            th, td {
                font-size: 10px;
                padding: 6px 3px;
                min-width: 60px;
            }
            .table-container {
                padding: 5px;
            }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        .pagination button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        .pagination button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .container {
            animation: fadeIn 0.8s ease-out;
        }

        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        #searchInput {
            padding: 15px 20px;
            width: 400px;
            border-radius: 25px;
            border: 2px solid transparent;
            background: #4682b4;
            color: #fff;
            font-size: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        #searchInput:focus {
            outline: none;
            border: 2px solid #64b5f6;
            box-shadow: 0 0 20px rgba(100, 181, 246, 0.3);
        }
        #searchInput::placeholder {
            color: #1a3d4d;
        }

        #searchInput::-webkit-search-cancel-button {
            -webkit-appearance: none;
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' stroke='%23000' stroke-width='2' fill='none'%3e%3cline x1='2' y1='2' x2='14' y2='14'/%3e%3cline x1='14' y1='2' x2='2' y2='14'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: center;
            background-size: 18px;
            cursor: pointer;
        }

        .student-row td {
            border-bottom: none !important;
        }

        /* Grupos de alunos usando tbody */
        tbody.student-group {
            display: table-row-group;
        }

        tbody.student-group:first-of-type {
            margin-top: 0;
        }

        /* Espaçamento entre grupos usando pseudo-elemento */
        tbody.student-group:not(:first-of-type)::before {
            content: '';
            display: table-row;
            height: 20px;
        }

        tbody.student-group:not(:first-of-type)::before td {
            height: 20px;
            border: none;
            background: transparent;
        }


     
      

     
    </style>
</head>
<body>
    <div class="container">
        <h1>Respostas dos Inscritos</h1>
        
        <div class="search-container">
            <input type="search" id="searchInput" placeholder="Buscar por nome ou WhatsApp">
        </div>
        <div class="stats-container" id="statsContainer">
            <div class="stat-card">
                <div class="stat-number" id="totalResponses">0</div>
                <div class="stat-label">Total de Respostas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayResponses">0</div>
                <div class="stat-label">Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="weekResponses">0</div>
                <div class="stat-label">Esta Semana</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgAge">0</div>
                <div class="stat-label">Idade Média</div>
            </div>
        </div>
        
      

        <div class="table-container">
            <table id="responsesTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>WhatsApp</th>
                        <th>Idade</th>
                        <th>Nível no Violão</th>
                        <th>Tipo de Música</th>
                        <th>Objetivo no Violão</th>
                        <th>Mais Informações</th>
                        
                        <th>Data</th>
                        <th>Término dos 15 dias</th>
                        
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="responsesTableBody">
                </tbody>
            </table>

            

        </div>

        <div class="pagination">
            <button id="prevPage" disabled>Anterior</button>
            <button id="nextPage">Próximo</button>
        </div>

        <div class="levels-container" style="display: flex; justify-content: center; gap: 15px; margin: 20px 0; flex-wrap: wrap;">
            <div class="level-card" style="background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(100, 181, 246, 0.1)); border-radius: 10px; padding: 15px; text-align: center; min-width: 200px; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.3s ease;">
                <p style="color: #2196f3; font-size: 18px; margin: 0 0 5px 0; font-weight: bold;">Zero</p>
                <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin-top: 5px;">Não sabe nada</p>
            </div>
            <div class="level-card" style="background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(100, 181, 246, 0.1)); border-radius: 10px; padding: 15px; text-align: center; min-width: 200px; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.3s ease;">
                <p style="color: #2196f3; font-size: 18px; margin: 0 0 5px 0; font-weight: bold;">Iniciante</p>
                <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin-top: 5px;">Sabe algo, mas não toca música inteira com segurança</p>
            </div>
            <div class="level-card" style="background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(100, 181, 246, 0.1)); border-radius: 10px; padding: 15px; text-align: center; min-width: 200px; border: 1px solid rgba(255,255,255,0.1); transition: transform 0.3s ease;">
                <p style="color: #2196f3; font-size: 18px; margin: 0 0 5px 0; font-weight: bold;">Intermediário</p>
                <p style="color: rgba(255,255,255,0.9); font-size: 14px; margin-top: 5px;">Toca pelo menos uma música inteira com segurança</p>
            </div>
        </div>

    </div>

    <script>
    const API_URL = 'https://lively-hall-dce9.suportegabriel7.workers.dev/inscricoes';
    const itemsPerPage = 10;
    let currentPage = 1;
    let allData = [];
    let openRow = null;

    function updateStats() {
        const total = allData.length;
        const today = new Date().toDateString();
        const todayCount = allData.filter(item => {
            if (!item.createdAt) return false;
            return new Date(item.createdAt).toDateString() === today;
        }).length;
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        const weekCount = allData.filter(item => {
            if (!item.createdAt) return false;
            return new Date(item.createdAt) >= weekAgo;
        }).length;
        const ages = allData.filter(item => item.idade && !isNaN(parseInt(item.idade)))
                    .map(item => parseInt(item.idade));
        const avgAge = ages.length > 0 ? Math.round(ages.reduce((a, b) => a + b, 0) / ages.length) : 0;
        document.getElementById('totalResponses').textContent = total;
        document.getElementById('todayResponses').textContent = todayCount;
        document.getElementById('weekResponses').textContent = weekCount;
        document.getElementById('avgAge').textContent = avgAge || '-';
    }

    async function loadData() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const text = await response.text();
            let result;
            try {
                result = JSON.parse(text);
            } catch (e) {
                console.error('Erro ao parsear JSON:', e, 'Dados recebidos:', text);
                throw new Error('Dados recebidos não são JSON válido');
            }
            allData = result.success && Array.isArray(result.data) ? result.data : [];
            updateStats();
            displayData();
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
        }
    }


    function formatTime(ms) {
        if (!ms || isNaN(ms)) return '-';
        const totalSeconds = ms / 1000;
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        if (minutes > 0) return `${minutes}min ${Math.floor(seconds)}s`;
        return `${totalSeconds.toFixed(2)}s`;
    }

    function formatSabeRitmo(sabeRitmo, ritmos, ritmoPersonalizado) {
        if (!sabeRitmo || sabeRitmo.toLowerCase() === 'nao' || sabeRitmo.toLowerCase() === 'não') {
            return 'Não';
        }
        
        if (sabeRitmo.toLowerCase() === 'sim') {
            let resultado = '';
            
            // Processar ritmos marcados
            if (ritmos) {
                const ritmosArray = ritmos.split(',').map(r => r.trim());
                const ritmoMap = {
                    'rock': 'Rock',
                    'poprock': 'Pop Rock', 
                    'pop rock': 'Pop Rock',
                    'dedilhado': 'Dedilhado',
                    'guarania': 'Guarânia',
                    'brega': 'Brega',
                    'sertanejo': 'Sertanejo',
                    'valsa': 'Valsa',
                    'balada': 'Balada'
                };
                
                const ritmosFormatados = ritmosArray.map(ritmo => 
                    ritmoMap[ritmo.toLowerCase()] || ritmo.charAt(0).toUpperCase() + ritmo.slice(1)
                );
                
                resultado = ritmosFormatados.join('<br>');
            }
            
            // Adicionar ritmo personalizado se existir
            if (ritmoPersonalizado) {
                if (resultado) resultado += '<br>';
                resultado += `<br><span style="color: #888; font-size: inherit;">Ritmo personalizado:</span><br><span style="color: #64b5f6;">${ritmoPersonalizado.charAt(0).toUpperCase() + ritmoPersonalizado.slice(1)}</span>`;
            }
            
            return resultado || 'Sim';
        }
        
        return formatSimNao(sabeRitmo);
    }

    function formatObjetivo(objetivoViolao, objetivoPersonalizado) {
        if (!objetivoViolao) return '-';
        
        if (objetivoViolao === 'outro' && objetivoPersonalizado) {
            return `<span style="color: #888; font-size: inherit;">Personalizado:</span><br><span style="color: #64b5f6;">${objetivoPersonalizado.charAt(0).toUpperCase() + objetivoPersonalizado.slice(1)}</span>`;
        }
        
        // Mapear valores para exibição
        const objetivoMap = {
            'hobbie': 'Hobbie',
            'amigos': 'Tocar em rodas de amigos',
            'igreja': 'Tocar na igreja',
            'sonho': 'É um sonho de muito tempo'
        };
        
        return objetivoMap[objetivoViolao.toLowerCase()] || objetivoViolao.charAt(0).toUpperCase() + objetivoViolao.slice(1);
    }

    function formatSimNao(valor) {
        if (!valor) return '-';
        if (valor.toLowerCase() === 'sim') return 'Sim';
        if (valor.toLowerCase() === 'nao' || valor.toLowerCase() === 'não') return 'Não';
        return valor.charAt(0).toUpperCase() + valor.slice(1);
    }

    function formatWhatsApp(number) {
        if (!number) return '';
        let cleanNumber = number.replace(/\D/g, '');
        if (cleanNumber.length === 10) {
            cleanNumber = `${cleanNumber.slice(0, 2)}9${cleanNumber.slice(2)}`;
        }
        if (cleanNumber.length === 11) {
            const ddd = cleanNumber.slice(0, 2);
            const firstPart = cleanNumber.slice(2, 7);
            const secondPart = cleanNumber.slice(7);
            return `+55 (${ddd}) ${firstPart}-${secondPart}`;
        }
        return cleanNumber;
    }

    function toggleDetails(rowId) {
        const detailsRow = document.getElementById(`details-${rowId}`);
        if (!detailsRow) return;
        
        const spacingRow = detailsRow.previousElementSibling;
        const verMaisRow = spacingRow.previousElementSibling;
        if (!verMaisRow) return;
        
        const verMais = verMaisRow.querySelector('.ver-mais');
        if (!verMais) return;
        
        // Fechar a linha aberta anteriormente, se houver
        if (openRow && openRow !== detailsRow) {
            openRow.style.display = 'none';
            const prevSpacingRow = openRow.previousElementSibling;
            if (prevSpacingRow && prevSpacingRow.classList.contains('spacing-row')) {
                prevSpacingRow.style.display = 'none';
            }
            const tempos = openRow.querySelector('.tempos-container');
            if (tempos) {
                tempos.style.display = 'none';
                const verTempos = tempos.previousElementSibling;
                if (verTempos) {
                    verTempos.textContent = 'Ver Tempos';
                    verTempos.classList.remove('active');
                }
            }
            const prevSpacingRowForVerMais = openRow.previousElementSibling;
            const prevVerMaisRow = prevSpacingRowForVerMais ? prevSpacingRowForVerMais.previousElementSibling : null;
            if (prevVerMaisRow) {
                const prevVerMais = prevVerMaisRow.querySelector('.ver-mais');
                if (prevVerMais) {
                    prevVerMais.textContent = 'Ver Mais Informações';
                    prevVerMaisRow.classList.remove('active');
                }
            }
        }

        // Alternar o estado da linha atual
        // Alternar o estado da linha atual
        const isHidden = detailsRow.style.display === 'none' || detailsRow.style.display === '';
        detailsRow.style.display = isHidden ? 'table-row' : 'none';
        spacingRow.style.display = isHidden ? 'table-row' : 'none';
        verMais.textContent = isHidden ? 'Fechar' : 'Ver Mais Informações';
        verMaisRow.classList.toggle('active', isHidden);
        openRow = isHidden ? detailsRow : null;
    }

    function toggleTempos(rowId) {
        const temposContainer = document.getElementById(`tempos-${rowId}`);
        const verTempos = temposContainer.previousElementSibling;
        const isHidden = temposContainer.style.display === 'none' || temposContainer.style.display === '';
        temposContainer.style.display = isHidden ? 'flex' : 'none';
        verTempos.textContent = isHidden ? 'Fechar' : 'Ver Tempos';
        verTempos.classList.toggle('active', isHidden);
    }

    function displayData() {
        allData.sort((a, b) => new Date(b.data_inscricao) - new Date(a.data_inscricao));
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filteredData = allData.filter(item => {
            try {
                return (
                    (item.nome?.toLowerCase()?.includes(searchTerm) || false) ||
                    (item.whatsapp?.includes(searchTerm) || false)
                );
            } catch (e) {
                return false;
            }
        });
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const paginatedData = filteredData.slice(start, end);
        
        // Recria toda a estrutura da tabela
        const tableContainer = document.querySelector('.table-container');
        tableContainer.innerHTML = `
            <table id="responsesTable">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>WhatsApp</th>
                        <th>Idade</th>
                        <th>Nível no Violão</th>
                        <th>Tipo de Música</th>
                        <th>Objetivo no Violão</th>
                        <th>Mais Informações</th>
                        <th>Data</th>
                        <th>Término dos 15 dias</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="responsesTableBody">
                    ${paginatedData.map(item => {
                        const isInvalid = typeof item.dados_pessoais_name === 'undefined' && typeof item.dados_pessoais === 'string';
                        const customLevel = item.nivel_personalizado ? `<br><small style="color: #64b5f6;">${item.nivel_personalizado.charAt(0).toUpperCase() + item.nivel_personalizado.slice(1)}</small>` : '';
                        const otherMusic = item.tipo_musica === 'outro' && item.tipo_musica_personalizado ? `<br><small style="color: #64b5f6;">${item.tipo_musica_personalizado.charAt(0).toUpperCase() + item.tipo_musica_personalizado.slice(1)}</small>` : '';
                        
                        const levelMap = {
                            'zero': 'Zero',
                            'iniciante': 'Iniciante',
                            'intermediario': 'Intermediário'
                        };
                        const musicMap = {
                            'sertaneja': 'Sertaneja',
                            'brega': 'Brega',
                            'catolica': 'Católica',
                            'evangelica': 'Evangélica',
                            'outro': 'Outro'
                        };
                        
                        const levelText = item.nivel_violao ? levelMap[item.nivel_violao] || item.nivel_violao.charAt(0).toUpperCase() + item.nivel_violao.slice(1) : '-';
                        const musicText = item.tipo_musica ? musicMap[item.tipo_musica] || item.tipo_musica.charAt(0).toUpperCase() + item.tipo_musica.slice(1) : '-';
                        
                        let totalTime = '-';
                        let stepTimes = [];
                        if (item.step_times && typeof item.step_times === 'string') {
                            try {
                                const parsedTimes = JSON.parse(item.step_times);
                                if (parsedTimes && typeof parsedTimes === 'object' && !Array.isArray(parsedTimes)) {
                                    const times = Object.values(parsedTimes).filter(val => typeof val === 'number' && val >= 0 && !isNaN(val));
                                    totalTime = times.length > 0 ? formatTime(times.reduce((a, b) => a + b, 0)) : '-';
                                    stepTimes = Object.entries(parsedTimes)
                                        .filter(([_, value]) => typeof value === 'number' && value >= 0 && !isNaN(value))
                                        .map(([key, value]) => ({
                                            name: key.replace('tempo_etapa', 'Etapa ').replace(/_/g, ' '),
                                            time: formatTime(value),
                                            value: value
                                        }))
                                        .sort((a, b) => b.value - a.value);
                                }
                            } catch (e) {
                                // Silenciar erro
                            }
                        }

                        return `
                            <tbody class="student-group">
                                <tr class="student-row" style="animation: fadeIn 0.5s ease-in;">
                                    <td><strong>${isInvalid ? '-' : (item.nome || '-')}</strong></td>
                                    <td>${isInvalid ? '-' : (item.whatsapp ? `<a href="whatsapp://send?phone=+55${item.whatsapp.replace(/\D/g, '')}" style="color: #64b5f6; text-decoration: none;" target="_self">${formatWhatsApp(item.whatsapp)}</a><button class="copy-btn" onclick="copyToClipboard('+55${item.whatsapp.replace(/\D/g, '')}')">📋</button>` : '-')}</td>
                                    <td>${isInvalid ? '-' : (item.idade || '-')} anos</td>
                                    <td>${isInvalid ? '-' : levelText}${customLevel}</td>
                                    <td>${isInvalid ? '-' : musicText}${otherMusic}</td>
                                    <td>${isInvalid ? '-' : formatObjetivo(item.objetivo_violao, item.objetivo_personalizado)}</td>
                                    <td>${item.mais_informacoes === 'sim' ? `${item.texto_extra ? `<span style="color: #64b5f6; font-size: 16px;">${item.texto_extra.charAt(0).toUpperCase() + item.texto_extra.slice(1)}</span>` : 'Sim'}` : (item.mais_informacoes === 'nao' ? 'Não' : item.mais_informacoes || '-')}</td>
                                    <td>${item.data_inscricao ? new Date(item.data_inscricao).toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' }) : '-'}</td>
                                    <td>${item.data_inscricao ? `${new Date(new Date(item.data_inscricao).setDate(new Date(item.data_inscricao).getDate() + 15)).toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: '2-digit' }).replace(/de /g, '')}<button class="copy-btn" onclick="copyToClipboard('${new Date(new Date(item.data_inscricao).setDate(new Date(item.data_inscricao).getDate() + 15)).toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: '2-digit' }).replace(/de /g, '')}')">📋</button>` : '-'}</td>
                                    <td><button class="delete-btn" onclick="deleteResponse('${item.documentId}')">🗑️</button></td>
                                </tr>
                                <tr class="ver-mais-row" onclick="toggleDetails('${item.documentId}')">
                                    <td colspan="10" class="ver-mais">Ver Mais Informações</td>
                                </tr>
                                <tr class="spacing-row" style="height: 20px;">
                                    <td colspan="10" style="background: transparent; border: none; padding: 0;"></td>
                                </tr>
                                <tr class="details-row" id="details-${item.documentId}">
                                    <td colspan="10" style="width: 100%; padding: 0;">
                                        <table class="details-table">
                                            <thead>
                                                <tr>
                                                    <th>Sabe Acorde</th>
                                                    <th>Sabe Afinar</th>
                                                    <th>Sabe Ritmo</th>
                                                    <th>Sabe Música</th>
                                                    <th>Dificuldade</th>
                                                    <th>Videochamada</th>
                                                    <th>Objetivo da Semana</th>
                                                    <th>Disponibilidade de Treino</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>${item.sabe_acorde === 'sim' && item.acorde_personalizado ? `<span style="color: #888; font-size: inherit;">Acordes que sabe:</span><br><span style="color: #64b5f6;">${item.acorde_personalizado}</span>` : formatSimNao(item.sabe_acorde)}</td>
                                                    <td>${formatSimNao(item.sabe_afinar)}</td>
                                                    <td>${formatSabeRitmo(item.sabe_ritmo, item.ritmos, item.ritmo_personalizado)}</td>
                                                    <td>${item.sabe_musica === 'sim' && item.musicas ? `<span style="color: #64b5f6; font-size: 17px;">${item.musicas}</span>` : formatSimNao(item.sabe_musica)}</td>
                                                    <td>${item.dificuldade_violao ? `<span style="color: #64b5f6; font-size: 16px;">${item.dificuldade_violao}</span>` : '-'}</td>
                                                    <td>${formatSimNao(item.videochamada)}</td>
                                                    <td>${item.objetivo_semana ? `<span style="color: #64b5f6; font-size: 16px;">${item.objetivo_semana}</span>` : '-'}</td>
                                                    <td>${formatSimNao(item.disponibilidade_treino)}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="ver-tempos" onclick="toggleTempos('${item.documentId}')">Ver Tempos</div>
                                        <div class="tempos-container" id="tempos-${item.documentId}">
                                            <div class="tempo-box total">Tempo Total: ${totalTime}</div>
                                            ${stepTimes.map(step => `<div class="tempo-box">${step.name}: ${step.time}</div>`).join('')}
                                            <div class="tempo-box id">ID: ${item.documentId}</div>
                                            <div class="tempo-box created">Criado Em: ${item.createdAt ? new Date(item.createdAt).toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' }) : '-'}</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            `;
                    }).join('')}
                </tbody>
            </table>
        `;

        document.getElementById('prevPage').disabled = currentPage === 1;
        document.getElementById('nextPage').disabled = end >= allData.length;
    }

    async function deleteResponse(id) {
        try {
            // Remove da tela imediatamente
            allData = allData.filter(item => item.documentId !== id);
            displayData();
            // Faz a requisição em background
            await fetch(`${API_URL}/${id}?method=1`, {
                method: 'DELETE'
            });
        } catch (error) {
            console.error('Erro ao apagar:', error);
            // Reverte a remoção caso a requisição falhe
            await loadData();
        }
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = 'Copiado com sucesso';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 2000);
            }, 100);
        }).catch(err => {
            console.error('Erro ao copiar:', err);
        });
    }

    let debounceTimeout;
    document.getElementById('searchInput').addEventListener('input', () => {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => {
            currentPage = 1;
            displayData();
        }, 300);
    });

    loadData();
    document.getElementById('prevPage').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            displayData();
            document.getElementById('responsesTable').scrollIntoView({ behavior: 'smooth' });
        }
    });
    document.getElementById('nextPage').addEventListener('click', () => {
        currentPage++;
        displayData();
        document.getElementById('responsesTable').scrollIntoView({ behavior: 'smooth' });
    });
    </script>
</body>
</html>