<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Violão Depois dos 40 - 15 dias Grátis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            padding: 20px;
            position: relative;
        }

        .step {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: calc(100vh - 80px);
            padding: 20px 0;
        }

      

        .step.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 80px);
            padding: 20px 0;
        }

        form {
            gap: 8px !important; /* Reduz espaço entre caixinhas */
        }

        .step label:has(input[type="radio"], input[type="checkbox"]) {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            line-height: 1.8;
        }
        .step label:has(input[type="radio"]) input[type="radio"],
        .step label:has(input[type="checkbox"]) input[type="checkbox"] {
            margin-right: 15px;
        }
        .step label:has(input[type="checkbox"]) > span {
            flex-grow: 1;
            text-align: left;
        }
        .step label:has(input[type="checkbox"]) > button {
            margin-left: auto;
        }

        .step-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #ccc;
            backdrop-filter: blur(10px);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
       
        .static {
        position: static !important;
        }


        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.3;
        }

        h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #e3f2fd;
            line-height: 1.3;
        }

        .intro-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            object-fit: contain;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .smaller-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            object-fit: contain;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .video-container {
            width: 100%;
            max-width: 90vw;
            margin-bottom: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        video {
            width: 100%;
            max-height: 50vh;
            object-fit: contain;
            height: auto;
            display: block;
        }

        .video-message {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
            font-style: italic;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
            min-width: 200px;
        }

        .btn-orange {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .btn-green {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            font-size: 20px;
            animation: pulse 2s infinite;
        }

        .btn-green:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .btn-blue {
            background: linear-gradient(45deg, #42a5f5, #64b5f6);
            color: white;
            box-shadow: 0 5px 15px rgba(66, 165, 245, 0.3);
        }

        .btn-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 165, 245, 0.4);
        }

        .triangle {
            display: inline-block;
            width: 0;
            height: 0;
            margin-left: 5px;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }

        .triangle-down {
            border-top: 6px solid white;
        }

        .triangle-up {
            border-bottom: 6px solid white;
        }

        
        

        .step#step9 h3 {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .btn:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn:disabled:hover {
            transform: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .faq {
            font-size: 20px;
            text-align: left;
            max-width: 350px;
            margin-bottom: 20px;
        }

        .faq-item {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #42a5f5;
        }

        .faq-question {
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 8px;
            
        }

        .faq-answer {
            color: #e3f2fd;
            line-height: 1.5;
        }

        .benefits {
            font-size: 20px;
            text-align: left;
            max-width: 350px;
            margin-bottom: 20px;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .benefit-item div:not(.benefit-icon) {
            z-index: 3;
        }

        .benefit-icon {
            font-size: 20px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #4caf50;
            border-radius: 50%;
            color: white;
            flex-shrink: 0;
        }




        



        .small-text {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
            font-style: italic;
        }

        .countdown {
            font-size: 14px;
            color: #ff6b35;
            margin-top: 10px;
        }

        .intro-text {
            font-size: 25px;
            color: #e3f2fd;
            line-height: 1.5;
            margin-bottom: 20px;
            max-width: 350px;
        }

        .final-title {
            font-size: 26px;
            margin-bottom: 15px;
            color: #4caf50;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            background: none;
            -webkit-text-fill-color: initial;
        }

        input, textarea {
            background-color: #4a4a4a; /* Fundo cinza */
            color: #fff; /* Texto branco */
        }
        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.5); /* Placeholder opaco */
            opacity: 1; /* Garante visibilidade */
        }

        label {
            margin-bottom: 10px; /* Aumenta a margem entre o título e o campo */
            display: block; /* Garante que o label ocupe a linha inteira */
        }

        .watermark {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 60px;
            height: auto;
            opacity: 0.7;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            z-index: 999;
            object-fit: contain;
        }
        

        .footer {
            width: 100%;
            min-height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: transparent;
            position: relative;
            margin-top: auto;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 20px;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 16px;
            }

            .intro-text, .faq, .benefits {
                margin-bottom: 15px;
            }

        }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- Etapa 0: Introdução -->
        <div class="step active" data-name="inicio" data-delay="0">
            <img src="images/img.webp" alt="Violão Depois dos 40" class="intro-image" onerror="this.style.display='none'">
            <h1>Acompanhamento<br>Violão Depois dos 40</h1>
            <p class="intro-text">
                🎸 Ganhe <strong>15 dias GRÁTIS</strong> do nosso acompanhamento exclusivo!
                <br><br>
                É simples: aperte no botão "Continuar" em cada etapa para garantir sua vaga.
            </p>
            <button class="btn btn-orange" onclick="nextStep()">Continuar</button>
            
        </div>

        <!-- Etapa 1: Explicação do acompanhamento e 15 dias grátis -->
        <div class="step" data-name="video_explicacao">
            <h2>Como funciona o acompanhamento e os 15 dias grátis?</h2>
            <div class="video-container">
                <video data-video="video_explicacao" controls autoplay muted>
                    <source src="video1.mp4" type="video/mp4">
                    Seu navegador não suporta vídeo HTML5.
                </video>
            </div>
            <p class="video-message">Assista o vídeo para o botão ser liberado</p>
            <button class="btn btn-orange" data-btn="video_explicacao" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="video_explicacao"></div>
        </div>

        <!-- Etapa 2: Vídeo inicial (Descubra Como Tocar Violão) -->
        <div class="step" data-name="video_inicial">
            <h2>🎯 Descubra Como Tocar Violão Depois dos 40 - Assista o vídeo</h2>
            <div class="video-container">
                <video data-video="video_inicial" controls autoplay muted>
                    <source src="vid.mp4" type="video/mp4">
                    Seu navegador não suporta vídeo HTML5.
                </video>
            </div>
            <p class="video-message">Assista o vídeo para o botão ser liberado</p>
            <button class="btn btn-orange" data-btn="video_inicial" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="video_inicial"></div>
        </div>

        <!-- Etapa 3: Depoimentos dos alunos -->
        <div class="step" data-name="depoimentos">
            <h2>🗣️ Veja o que nossos alunos dizem</h2>
            <div class="video-container">
                <video data-video="depoimentos" controls autoplay muted>
                    <source src="vid2.mp4" type="video/mp4">
                    Seu navegador não suporta vídeo HTML5.
                </video>
            </div>
            <p class="video-message">Assista pelo menos um pouco do vídeo para liberar o botão</p>
            <button class="btn btn-orange" data-btn="depoimentos" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="depoimentos"></div>
        </div>

        <!-- Etapa 4: Formulário de dados pessoais (Nome, WhatsApp, Idade) -->
        <div class="step" data-name="dados_pessoais" data-delay="0">
            <h2>Preencha seus dados</h2>
            <form data-form="dados_pessoais" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <div>
                    <label for="nome">Nome e sobrenome:</label>
                    <input type="text" id="nome" name="nome" required placeholder="Insira seu nome e sobrenome" style="width: 100%; padding: 10px; border-radius: 5px; border: none;">
                </div>
                <div>
                    <label for="whatsapp">WhatsApp com DDD sem o zero:</label>
                    <input type="number" id="whatsapp" name="whatsapp" required placeholder="Insira seu WhatsApp com DDD sem o zero" style="width: 100%; padding: 10px; border-radius: 5px; border: none;">
                </div>
                <div>
                    <label for="idade">Qual a sua idade?</label>
                    <input type="number" id="idade" name="idade" required placeholder="Insira sua idade" min="40" max="99" style="width: 100%; padding: 10px; border-radius: 5px; border: none;">
                </div>
                <p class="small-text">Preencha todos os campos para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="dados_pessoais" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="dados_pessoais"></div>
        </div>
        
        <!-- Etapa 5: Seleção do nível no violão -->
        <div class="step" data-name="nivel_violao" data-delay="0">
            <h2>Qual o seu nível no violão?</h2>
            <img style="margin-bottom: 30px" src="images/nivel.png" alt="Nível no violão" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="nivel_violao" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="nivel" value="zero" required> Estou começando do zero (não sei nada)</label>
                <label><input type="radio" name="nivel" value="iniciante"> Já sei alguma coisinha mas ainda não toco nenhuma música inteira com segurança</label>
                <label><input type="radio" name="nivel" value="intermediario"> Já toco pelo menos uma música inteira com segurança</label>
                <label><input type="radio" name="nivel" value="personalizado" id="nivelPersonalizado"> Prefiro escrever e explicar qual o meu nível no violão</label>
                <textarea id="textoNivelPersonalizado" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Insira seu nível no violão"></textarea>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="nivel_violao" disabled>Continuar</button>

            </form>
            <div class="countdown" data-countdown="nivel_violao"></div>
        </div>

        <!-- Etapa 6: Seleção do tipo de música -->
        <div class="step" data-name="tipo_musica" data-delay="0">
            <h2>Que tipo de música você pretende aprender a tocar no violão?</h2>
            <img style="margin-bottom: 30px" src="images/tipo.jpg" alt="Tipo de música" class="intro-image" onerror="this.style.display='none'">
            <form data-form="tipo_musica" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="musica" value="sertaneja" required> Sertaneja</label>
                <label><input type="radio" name="musica" value="brega"> Brega</label>
                <label><input type="radio" name="musica" value="catolica"> Católica</label>
                <label><input type="radio" name="musica" value="evangelica"> Evangélica</label>
                <label><input type="radio" name="musica" value="outro" id="outraMusica"> Outro</label>
                <textarea id="textoOutraMusica" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Insira o tipo de música"></textarea>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="tipo_musica" disabled>Continuar</button>

            </form>
            <div class="countdown" data-countdown="tipo_musica"></div>
        </div>

        <!-- Etapa 7: Você já sabe algum acorde? -->
        <div class="step" data-name="sabe_acorde" data-delay="0">
            <h2>Você já sabe algum acorde? (Que alguns chamam de posição ou nota)</h2>
            <p style="margin-bottom: 20px;">Como: A (Lá maior), E (Mi maior), D (Ré maior)</p>
            <img style="margin-bottom: 30px" src="images/acorde.png" alt="Exemplo de acorde" class="intro-image" onerror="this.style.display='none'">
            <form data-form="sabe_acorde" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="sabeAcorde" value="nao" required> Não</label>
                <label><input type="radio" name="sabeAcorde" value="sim" id="sabeAcordeSim"> Sim</label>
                <div id="acordesOptions" style="display: none;">
                    <p style="margin-bottom: 20px; color: rgb(182, 182, 182)">Marque abaixo o que você já sabe:</p>
                    <label><input type="radio" name="tipoAcorde" value="simples"> Acordes simples como A (Lá maior), E (Mi maior), D (Ré maior)</label>
                    <label><input type="radio" name="tipoAcorde" value="pestana"> Acordes com pestana como F ou Bm</label>
                    <label><input type="radio" name="tipoAcorde" value="personalizado" id="acordePersonalizado"> Vou escrever quais acordes eu já faço</label>
                    <textarea id="textoAcordePersonalizado" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Insira os acordes que você já faz"></textarea>
                </div>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="sabe_acorde" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="sabe_acorde"></div>
        </div>

        <!-- Etapa 8: Você já sabe afinar o violão? -->
        <div class="step" data-name="sabe_afinar" data-delay="0">
            <h2>Você já sabe afinar o violão?</h2>
            <img style="margin-bottom: 30px" src="images/afinar.jpg" alt="Afinação do violão" class="intro-image" onerror="this.style.display='none'">
            <form data-form="sabe_afinar" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="sabeAfinar" value="sim" required> Sim</label>
                <label><input type="radio" name="sabeAfinar" value="nao"> Não</label>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="sabe_afinar" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="sabe_afinar"></div>
        </div>

        <!-- Etapa 9: Você já sabe algum ritmo? -->
        <div class="step" data-name="sabe_ritmo" data-delay="0">
            <h2>Você já sabe algum ritmo?</h2>
            <img style="margin-bottom: 30px" src="images/ritmo.jpg" alt="Ritmo no violão" class="intro-image" onerror="this.style.display='none'">
            <form data-form="sabe_ritmo" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="sabeRitmo" value="nao" required> Não</label>
                <label><input type="radio" name="sabeRitmo" value="sim" id="sabeRitmoSim"> Sim</label>
                <div id="ritmosOptions" style="display: none;">
                    <p style="margin-bottom: 20px; color: rgb(182, 182, 182)">Marque abaixo o que você já sabe, se não souber por nome aperte em ver ritmo.<br><br>Pode marcar mais de um.</p>
                    <label>
                        <input type="checkbox" name="ritmo" value="guarania"> Guarânia
                        <button type="button" class="btn btn-blue" style="padding: 5px 10px; font-size: 14px; min-width: auto;" onclick="toggleVideo('videoGuarania')">
                            Ver ritmo <span class="triangle triangle-down"></span>
                        </button>
                    </label>
                    <div data-video="videoGuarania" style="display: none;">
                        <h3>Dê o play pra ver se você já conhece esse ritmo</h3>
                        <div class="video-container">
                            <video controls loop>
                                <source src="Exemplo Ritmo Guarânia.mp4" type="video/mp4">
                                Seu navegador não suporta vídeo HTML5.
                            </video>
                        </div>
                    </div>
                    <label>
                        <input type="checkbox" name="ritmo" value="rock"> Rock
                        <button type="button" class="btn btn-blue" style="padding: 5px 10px; font-size: 14px; min-width: auto;" onclick="toggleVideo('videoRock')">
                            Ver ritmo <span class="triangle triangle-down"></span>
                        </button>
                    </label>
                    <div data-video="videoRock" style="display: none;">
                        <h3>Dê o play pra ver se você já conhece esse ritmo</h3>
                        <div class="video-container">
                            <video controls loop>
                                <source src="Exemplo Ritmo Rock.mp4" type="video/mp4">
                                Seu navegador não suporta vídeo HTML5.
                            </video>
                        </div>
                    </div>
                    <label>
                        <input type="checkbox" name="ritmo" value="poprock"> Pop Rock
                        <button type="button" class="btn btn-blue" style="padding: 5px 10px; font-size: 14px; min-width: auto;" onclick="toggleVideo('videoPopRock')">
                            Ver ritmo <span class="triangle triangle-down"></span>
                        </button>
                    </label>
                    <div data-video="videoPopRock" style="display: none;">
                        <h3>Dê o play pra ver se você já conhece esse ritmo</h3>
                        <div class="video-container">
                            <video controls loop>
                                <source src="Exemplo de Pop Rock.mp4" type="video/mp4">
                                Seu navegador não suporta vídeo HTML5.
                            </video>
                        </div>
                    </div>
                    <label>
                        <input type="checkbox" name="ritmo" value="dedilhado"> Dedilhado
                    </label>
                    <label>
                        <input type="radio" name="ritmoPersonalizado" value="personalizado" id="ritmoPersonalizado"> Vou escrever quais ritmos eu já faço
                    </label>
                    <textarea id="textoRitmoPersonalizado" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Insira os ritmos que você já faz"></textarea>
                </div>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="sabe_ritmo" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="sabe_ritmo"></div>
        </div>

        <!-- Etapa 10: Você já sabe tocar alguma música inteira com segurança? -->
        <div class="step" data-name="sabe_musica" data-delay="0">
            <h2>Você já sabe tocar alguma música inteira com segurança?</h2>
            <img style="margin-bottom: 30px" src="images/musica_inteira.png" alt="Música inteira" class="intro-image" onerror="this.style.display='none'">
            <form data-form="sabe_musica" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="sabeMusica" value="sim" required> Sim</label>
                <textarea id="textoMusica" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Qual ou quais músicas você já toca?"></textarea>
                <label><input type="radio" name="sabeMusica" value="nao"> Não</label>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="sabe_musica" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="sabe_musica"></div>
        </div>

        <!-- Etapa 11: Qual o seu objetivo com o violão? -->
        <div class="step" data-name="objetivo_violao" data-delay="0">
            <h2>Qual o seu objetivo principal com o violão?</h2>
            <img style="margin-bottom: 30px" src="images/objetivo.png" alt="Objetivo com o violão" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="objetivo_violao" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="objetivo" value="hobbie" required> Hobbie</label>
                <label><input type="radio" name="objetivo" value="amigos"> Tocar em rodas de amigos</label>
                <label><input type="radio" name="objetivo" value="igreja"> Tocar na igreja</label>
                <label><input type="radio" name="objetivo" value="sonho"> É um sonho de muito tempo</label>
                <label><input type="radio" name="objetivo" value="outro" id="objetivoOutro"> Outro</label>
                <textarea id="textoObjetivo" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Escreva qual o seu objetivo"></textarea>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="objetivo_violao" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="objetivo_violao"></div>
        </div>

        <!-- Etapa 12: Qual a sua maior dificuldade hoje no violão? -->
        <div class="step" data-name="dificuldade_violao" data-delay="0">
            <h2>Qual a sua maior dificuldade hoje no violão?</h2>
            <img style="margin-bottom: 30px" src="images/dificuldade.png" alt="Dificuldade no violão" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="dificuldade_violao" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <textarea id="textoDificuldade" style="width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 100px;" placeholder="Escreva sua maior dificuldade"></textarea>
                <p class="small-text">Escreva sua dificuldade para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="dificuldade_violao" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="dificuldade_violao"></div>
        </div>

        <!-- Etapa 13: Participação na videochamada -->
        <div class="step" data-name="videochamada" data-delay="0">
            <h2>Você vai poder participar da videochamada segunda 20h?</h2>
            <img style="margin-bottom: 30px" src="images/videochamada20h.jpg" alt="Videochamada" class="intro-image" onerror="this.style.display='none'">
            <form data-form="videochamada" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="videochamada" value="sim" required> Posso participar segunda 20h da videochamada</label>
                <label><input type="radio" name="videochamada" value="nao"> Não posso no horário, então vou mandar minha dúvida ou progresso no grupo</label>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="videochamada" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="videochamada"></div>
        </div>

        <!-- Etapa 14: Disponibilidade para treinar -->
        <div class="step" data-name="disponibilidade_treino" data-delay="0">
            <h2>Pra aprender violão é necessário tempo.<br><br>Você tem como treinar pelo menos 3 dias na semana por 30 minutos?</h2>
            <img style="margin-bottom: 30px" src="images/tempo.png" alt="Disponibilidade para treino" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="disponibilidade_treino" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="disponibilidade" value="sim" required> Sim</label>
                <label><input type="radio" name="disponibilidade" value="nao"> Não</label>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="disponibilidade_treino" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="disponibilidade_treino"></div>
        </div>

        <!-- Etapa 14: Objetivo da semana -->
        <div class="step" data-name="objetivo_semana" data-delay="0">
            <h2>Qual objetivo você espera alcançar já nessa semana com o violão?</h2>
            <img style="margin-bottom: 30px" src="images/objetivosemana.png" alt="Objetivo da semana" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="objetivo_semana" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <textarea id="textoObjetivoSemana" style="width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 100px;" placeholder="Escreva seu objetivo para essa semana"></textarea>
                <p class="small-text">Escreva seu objetivo para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="objetivo_semana" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="objetivo_semana"></div>
        </div>

        <!-- Etapa 7: Informações adicionais antes da inscrição -->
        <div class="step" data-name="informacoes_extras" data-delay="0">
            <h2>Quer me informar mais alguma coisa antes de se inscrever?</h2>
            <img style="margin-bottom: 30px" src="images/informar.png" alt="Informações adicionais" class="smaller-image" onerror="this.style.display='none'">
            <form data-form="informacoes_extras" style="max-width: 350px; display: flex; flex-direction: column; gap: 15px; text-align: left;">
                <label><input type="radio" name="extra" value="nao" required> Não</label>
                <label><input type="radio" name="extra" value="sim" id="extraSim"> Sim</label>
                <textarea id="textoExtra" style="display: none; width: 100%; padding: 10px; border-radius: 5px; border: none; resize: none; min-height: 50px;" placeholder="Insira informações adicionais"></textarea>
                <p class="small-text">Selecione uma opção para continuar</p>
                <button type="submit" class="btn btn-orange" data-btn="informacoes_extras" disabled>Continuar</button>
            </form>
            <div class="countdown" data-countdown="informacoes_extras"></div>
        </div>

        

        <!-- Etapa 8: Perguntas Frequentes (Parte 1) -->
        <div class="step" data-name="faq_parte1">
            <h2>❓ Perguntas Frequentes</h2>
            <div class="faq">
                <div class="faq-item">
                    <div class="faq-question">Preciso ter violão pra entrar?</div>
                    <div class="faq-answer">Sim. Se não tiver violão, providencie um antes de entrar.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Funciona para iniciantes?</div>
                    <div class="faq-answer">Sim, o acompanhamento é para iniciantes do zero ou que ainda não tocam músicas com facilidade.</div>
                </div>
            </div>
            <p class="small-text">Se tiver entendido, pressione continuar</p>
            <button class="btn btn-orange" data-btn="faq_parte1" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="faq_parte1"></div>
        </div>

        <!-- Etapa 9: Perguntas Frequentes (Parte 2) -->
        <div class="step" data-name="faq_parte2">
            <h2>❓ Perguntas Frequentes</h2>
            <div class="faq">
                <div class="faq-item">
                    <div class="faq-question">Qual o dia e horário das videochamadas?</div>
                    <div class="faq-answer">Toda segunda-feira 20h.</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">É obrigatório participar da videochamada?</div>
                    <div class="faq-answer">Não!<br><br>Eu consigo acompanhar você no grupo e tirar tuas dúvidas. E existe o curso gravado também.</div>
                </div>
            </div>
            <p class="small-text">Se tiver entendido, pressione continuar</p>
            <button class="btn btn-orange" data-btn="faq_parte2" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="faq_parte2"></div>
        </div>

        <!-- Etapa 10: Resumo dos Benefícios -->
        <div class="step" data-name="resumo_beneficios">
            <h2 style="font-size: 28px;">✨ Resumo dos Benefícios</h2>
            <div class="benefits">
                <div class="benefit-item">
                    <div class="benefit-icon">📹</div>
                    <div>Você vai aprender a tocar as músicas que você gosta</div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">🎯</div>
                    <div>Aprendizado na prática sem ficar enrolando com teoria</div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">📚</div>
                    <div>Você escolhe seu treino e aprende no seu tempo</div>
                </div>
            </div>
            <p class="small-text">Se tiver entendido, pressione continuar</p>
            <button class="btn btn-orange" data-btn="resumo_beneficios" disabled onclick="nextStep()">Continuar</button>
            <div class="countdown" data-countdown="resumo_beneficios"></div>
        </div>

        <!-- Etapa 11: Cadastro Final (15 dias grátis) -->
        <div class="step" data-name="cadastro_final">
            <h1 class="final-title">🎉 Última Etapa!</h1>
            <h2>Você vai ganhar seus 15 dias grátis agora!</h2>
            <p class="intro-text">
            Se gostar e quiser continuar,<br>o valor da mensalidade é: <br>R$100 por mês.<br><br>
                Pode cancelar quando quiser.<br>
            </p>
            <button class="btn btn-green" data-btn="cadastro_final" onclick="captureStep19Time(); saveStepTimes(); sendToFirebase(); window.open('https://wa.me/5595984224764?text=Vi%20todos%20os%20detalhes%20e%20quero%20aproveitar%20os%2015%20dias%20gr%C3%A1tis', '_blank')">
                🎸 Quero meus 15 dias grátis
            </button>
            <div class="countdown" data-countdown="cadastro_final"></div>
        
    </div>

    <div class="footer">
        <img src="images/img2.png" alt="Marca d'água" class="watermark">
        <div class="step-indicator" id="stepIndicator">
            Etapa 0 de 20
        </div>
    </div>

    <script>
        const ENABLE_DELAY = 1; // 1 = delay ativado, 0 = delay desativado
        
        const steps = Array.from(document.querySelectorAll('.step')).map(step => step.dataset.name);
        const stepNames = steps; // Alias para compatibilidade
        let currentStep = steps[0]; // Inicia com o data-name da primeira etapa
        let stepTimes = {};
        steps.forEach(name => {
            stepTimes[`tempo_${name}`] = 0;
        });
        let stepStartTime = Date.now();
        
        const USE_MILLISECONDS = 1; // 1 = milissegundos, 0 = segundos

        const DELAY_FAQ = 3; // Delay para FAQs e etapas finais (etapas 16-19)
        const DELAY_VIDEO_EXPLICACAO = 78; // Etapa 1
        const DELAY_VIDEO_INICIAL = 18; // Etapa 2
        const DELAY_DEPOIMENTOS = 60; // Etapa 3

        function formatTimeSpent(startTime, endTime) {
            const timeDiff = endTime - startTime;
            return USE_MILLISECONDS ? timeDiff : Math.round(timeDiff / 1000);
        }

        function captureStep19Time() {
            if (stepStartTime && currentStep === 'cadastro_final') {
                const endTime = Date.now();
                const timeSpent = formatTimeSpent(stepStartTime, endTime);
                stepTimes[`tempo_${currentStep}`] = timeSpent;
                sessionStorage.setItem('stepTimes', JSON.stringify(stepTimes));
                console.log(`Tempo Etapa cadastro_final capturado: ${timeSpent}ms`);
            } else {
                console.error('Erro: stepStartTime ou currentStep inválido na Etapa cadastro_final');
            }
        }

        const AUTO_TEST = 0; // 1 para ativar o teste automático, 0 para desativar
        

        // Inicializa stepTimes com valores padrão
        stepNames.forEach(name => {
            stepTimes[`tempo_${name}`] = 0;
        });

        // Carrega dados do sessionStorage, se existirem, e mescla com valores padrão
        if (sessionStorage.getItem('stepTimes')) {
            const savedTimes = JSON.parse(sessionStorage.getItem('stepTimes'));
            stepTimes = { ...stepTimes, ...savedTimes };
        } else {
            sessionStorage.setItem('stepTimes', JSON.stringify(stepTimes));
        }

        function autoTest() {
            if (!AUTO_TEST) return;

            console.log('Iniciando teste automático');

            function fillStep(stepIndex) {
                console.log(`Iniciando preenchimento da etapa ${stepIndex}`);
                if (stepIndex === 0) {
                    console.log('Etapa 0: Aguardando clique manual');
                    return;
                }

                const stepName = stepNames[stepIndex];
                const stepElement = document.querySelector(`.step[data-name="${stepName}"]`);
                const btn = document.querySelector(`[data-btn="${stepName}"]`);
                const delay = parseInt(stepElement.dataset.delay) || DELAY_FAQ;

                if (stepName === 'video_explicacao') {
                    console.log('Clicando no botão da etapa video_explicacao');
                    setTimeout(() => document.querySelector('[data-btn="video_explicacao"]').click(), delay * 1000);
                } else if (stepName === 'video_inicial') {
                    console.log('Clicando no botão da etapa video_inicial');
                    setTimeout(() => document.querySelector('[data-btn="video_inicial"]').click(), delay * 1000);
                } else if (stepName === 'depoimentos') {
                    console.log('Clicando no botão da etapa depoimentos');
                    setTimeout(() => document.querySelector('[data-btn="depoimentos"]').click(), delay * 1000);
                } else if (stepIndex === 4) {
                    console.log('Preenchendo formulário da etapa 4: nome, whatsapp, idade');
                    document.getElementById('nome').value = 'Teste Auto';
                    document.getElementById('whatsapp').value = '11987654321';
                    document.getElementById('idade').value = '40';
                    document.getElementById('nome').dispatchEvent(new Event('input', { bubbles: true }));
                    document.getElementById('whatsapp').dispatchEvent(new Event('input', { bubbles: true }));
                    document.getElementById('idade').dispatchEvent(new Event('input', { bubbles: true }));
                    console.log('Clicando no botão da etapa 4');
                    setTimeout(() => document.querySelector('[data-btn="dados_pessoais"]').click(), 100);
                } else if (stepIndex === 5) {
                    console.log('Preenchendo formulário da etapa 5: nível zero');
                    document.querySelector('[data-form="nivel_violao"] input[value="zero"]').checked = true;
                    document.querySelector('[data-form="nivel_violao"] input[value="zero"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 5');
                    setTimeout(() => document.querySelector('[data-btn="nivel_violao"]').click(), 100);
                } else if (stepIndex === 6) {
                    console.log('Preenchendo formulário da etapa 6: música sertaneja');
                    document.querySelector('[data-form="tipo_musica"] input[value="sertaneja"]').checked = true;
                    document.querySelector('[data-form="tipo_musica"] input[value="sertaneja"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 6');
                    setTimeout(() => document.querySelector('[data-btn="tipo_musica"]').click(), 100);
                } else if (stepIndex === 7) {
                    console.log('Preenchendo formulário da etapa 7: não sabe acorde');
                    document.querySelector('[data-form="sabe_acorde"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="sabe_acorde"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 7');
                    setTimeout(() => document.querySelector('[data-btn="sabe_acorde"]').click(), 100);
                } else if (stepIndex === 8) {
                    console.log('Preenchendo formulário da etapa 8: não sabe afinar');
                    document.querySelector('[data-form="sabe_afinar"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="sabe_afinar"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 8');
                    setTimeout(() => document.querySelector('[data-btn="sabe_afinar"]').click(), 100);
                } else if (stepIndex === 9) {
                    console.log('Preenchendo formulário da etapa 9: não sabe ritmo');
                    document.querySelector('[data-form="sabe_ritmo"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="sabe_ritmo"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 9');
                    setTimeout(() => document.querySelector('[data-btn="sabe_ritmo"]').click(), 100);
                } else if (stepIndex === 10) {
                    console.log('Preenchendo formulário da etapa 10: não sabe tocar música');
                    document.querySelector('[data-form="sabe_musica"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="sabe_musica"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 10');
                    setTimeout(() => document.querySelector('[data-btn="sabe_musica"]').click(), 100);
                } else if (stepIndex === 11) {
                    console.log('Preenchendo formulário da etapa 11: objetivo hobbie');
                    document.querySelector('[data-form="objetivo_violao"] input[value="hobbie"]').checked = true;
                    document.querySelector('[data-form="objetivo_violao"] input[value="hobbie"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 11');
                    setTimeout(() => document.querySelector('[data-btn="objetivo_violao"]').click(), 100);
                } else if (stepIndex === 12) {
                    console.log('Preenchendo formulário da etapa 12: dificuldade');
                    document.getElementById('textoDificuldade').value = 'Teste dificuldade';
                    document.getElementById('textoDificuldade').dispatchEvent(new Event('input', { bubbles: true }));
                    console.log('Clicando no botão da etapa 12');
                    setTimeout(() => document.querySelector('[data-btn="dificuldade_violao"]').click(), 100);
                } else if (stepIndex === 13) {
                    console.log('Preenchendo formulário da etapa 13: não quer videochamada');
                    document.querySelector('[data-form="videochamada"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="videochamada"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 13');
                    setTimeout(() => document.querySelector('[data-btn="videochamada"]').click(), 100);
                } else if (stepIndex === 14) {
                    console.log('Preenchendo formulário da etapa 14: objetivo semana');
                    document.getElementById('textoObjetivoSemana').value = 'Teste objetivo semana';
                    document.getElementById('textoObjetivoSemana').dispatchEvent(new Event('input', { bubbles: true }));
                    console.log('Clicando no botão da etapa 14');
                    setTimeout(() => document.querySelector('[data-btn="objetivo_semana"]').click(), 100);
                } else if (stepIndex === 15) {
                    console.log('Preenchendo formulário da etapa 15: sem informações extras');
                    document.querySelector('[data-form="informacoes_extras"] input[value="nao"]').checked = true;
                    document.querySelector('[data-form="informacoes_extras"] input[value="nao"]').dispatchEvent(new Event('change', { bubbles: true }));
                    console.log('Clicando no botão da etapa 15');
                    setTimeout(() => document.querySelector('[data-btn="informacoes_extras"]').click(), 100);
                } else if (stepIndex >= 16 && stepIndex < totalSteps - 1) {
                    console.log(`Clicando no botão da etapa ${stepIndex}`);
                    setTimeout(() => {
                        const btn = document.querySelector(`[data-btn="${stepNames[stepIndex]}"]`);
                        if (btn) {
                            btn.disabled = false;
                            btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                            btn.click();
                            console.log(`Botão da etapa ${stepNames[stepIndex]} clicado`);
                        } else {
                            console.error(`Erro: Botão btn${stepNames[stepIndex]} não encontrado`);console.error(`Erro: Botão btn${step} não encontrado`);
                        }
                    }, delay * 1000);
                } else if (stepIndex === totalSteps - 1) {
                    console.log(`Aguardando ativação da etapa ${stepIndex}`);
                    setTimeout(() => {
                        const btn = document.querySelector(`[data-btn="${stepNames[stepIndex]}"]`);
                        const stepElement = document.querySelector(`.step[data-name="${stepNames[stepIndex]}"]`);
                        if (btn && stepElement && stepElement.classList.contains('active')) {
                            btn.disabled = false;
                            btn.click();
                            console.log(`Botão da etapa ${step} clicado com sucesso`);
                        } else {
                            console.error(`Erro: Botão btn${stepNames[stepIndex]} ou etapa step${stepNames[stepIndex]} não encontrado ou não ativo`);console.error(`Erro: Botão btn${step} ou etapa step${step} não encontrado ou não ativo`);
                            setTimeout(() => fillStep(stepIndex), 500);
                        }
                    }, delay * 1000);
                }
            }
        }
        
        
        const totalSteps = steps.length;
        
        function updateStepIndicator() {
            const visibleTotal = steps.length - 1;
            const currentIndex = steps.indexOf(currentStep);
            document.getElementById('stepIndicator').textContent = `Etapa ${currentIndex} de ${visibleTotal}`;
        }

        
        function getStepFromURL() {
            if (!steps || steps.length === 0) {
                console.error('Erro: steps não inicializado');
                return;
            }
            const stepIndex = parseInt(window.location.hash.replace('#', '')) || 0;
            if (stepIndex >= 0 && stepIndex < totalSteps) {
                currentStep = stepNames[stepIndex];
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.querySelector(`.step[data-name="${currentStep}"]`).classList.add('active');
                updateStepIndicator();
                stepStartTime = Date.now();
                const setupFunctions = {
                    'video_explicacao': setupVideoDelayNew,
                    'video_inicial': setupVideoDelay,
                    'depoimentos': setupVideoDelay2,
                    'dados_pessoais': setupFormDelay,
                    'nivel_violao': setupLevelForm,
                    'tipo_musica': setupMusicForm,
                    'sabe_acorde': setupChordForm,
                    'sabe_afinar': setupTuneForm,
                    'sabe_ritmo': setupRhythmForm,
                    'sabe_musica': setupSongForm,
                    'objetivo_violao': setupGoalForm,
                    'dificuldade_violao': setupDifficultyForm,
                    'videochamada': setupCallForm,
                    'disponibilidade_treino': setupTrainingForm,
                    'objetivo_semana': setupWeeklyGoalForm,
                    'informacoes_extras': setupExtraForm15
                };
                if (setupFunctions[currentStep]) {
                    setupFunctions[currentStep]();
                } else if (steps.indexOf(currentStep) >= steps.indexOf('faq_parte1') && steps.indexOf(currentStep) < totalSteps - 1) {
                    setupDelay(`btn_${currentStep}`, `countdown_${currentStep}`, currentStep);
                } else if (currentStep === 'cadastro_final') {
                    const btn = document.querySelector(`[data-btn="${currentStep}"]`);
                    if (btn) btn.disabled = false;
                }
            }
        }

        function nextStep() {
            document.querySelectorAll('video').forEach(video => {
                video.pause();
                video.currentTime = 0;
            });

            document.querySelector(`.step[data-name="${currentStep}"]`).classList.remove('active');
            
            if (stepStartTime && stepNames.includes(currentStep)) {
                const endTime = Date.now();
                const timeSpent = formatTimeSpent(stepStartTime, endTime);
                stepTimes[`tempo_${currentStep}`] = timeSpent;
                stepStartTime = Date.now();
            }

            let nextStepIndex = stepNames.indexOf(currentStep) + 1;
            if (stepNames[nextStepIndex] === 'sabe_musica') {
                const formData = JSON.parse(sessionStorage.getItem('formData') || '{}');
                const sabeAcorde = formData.sabe_acorde?.sabeAcorde || 'nao';
                const sabeRitmo = formData.sabe_ritmo?.sabeRitmo || 'nao';
                if (sabeAcorde !== 'sim' || sabeRitmo !== 'sim') {
                    nextStepIndex = steps.indexOf('objetivo_violao');
                }
            }
            if (nextStepIndex >= totalSteps) {
                nextStepIndex = totalSteps - 1;
            }
            currentStep = stepNames[nextStepIndex];

            document.querySelector(`.step[data-name="${currentStep}"]`).classList.add('active');
            updateStepIndicator();

            const setupFunctions = {
                'video_explicacao': setupVideoDelayNew,
                'video_inicial': setupVideoDelay,
                'depoimentos': setupVideoDelay2,
                'dados_pessoais': setupFormDelay,
                'nivel_violao': setupLevelForm,
                'tipo_musica': setupMusicForm,
                'sabe_acorde': setupChordForm,
                'sabe_afinar': setupTuneForm,
                'sabe_ritmo': setupRhythmForm,
                'sabe_musica': setupSongForm,
                'objetivo_violao': setupGoalForm,
                'dificuldade_violao': setupDifficultyForm,
                'videochamada': setupCallForm,
                'disponibilidade_treino': setupTrainingForm,
                'objetivo_semana': setupWeeklyGoalForm,
                'informacoes_extras': setupExtraForm15
            };
            if (setupFunctions[currentStep]) {
                setupFunctions[currentStep]();
            } else if (steps.indexOf(currentStep) >= steps.indexOf('faq_parte1') && steps.indexOf(currentStep) < totalSteps - 1) {
                setupDelay(`btn_${currentStep}`, `countdown_${currentStep}`, currentStep);
            } else if (currentStep === 'cadastro_final') {
                const btn = document.querySelector(`[data-btn="${currentStep}"]`);
                if (btn) {
                    btn.disabled = false;
                    stepStartTime = Date.now();
                    if (AUTO_TEST) {
                        btn.click();
                        console.log(`Botão da etapa ${currentStep} clicado automaticamente`);
                    }
                } else {
                    console.error(`Erro: Botão btn_${currentStep} não encontrado`);
                }
            }

            setTimeout(() => {
                const activeVideo = document.querySelector('.step.active video');
                if (activeVideo) activeVideo.play();
            }, 100);
        }
        

        

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        


        

        function scrollTextareaToTop(textarea) {
            textarea.addEventListener('input', () => {
                const cursorPosition = textarea.selectionStart;
                const textBeforeCursor = textarea.value.substring(0, cursorPosition);
                const tempDiv = document.createElement('div');
                tempDiv.style.cssText = `
                    position: absolute;
                    visibility: hidden;
                    width: ${textarea.offsetWidth}px;
                    font: ${getComputedStyle(textarea).font};
                    padding: ${getComputedStyle(textarea).padding};
                    white-space: pre-wrap;
                    line-height: ${getComputedStyle(textarea).lineHeight};
                    border: ${getComputedStyle(textarea).border};
                `;
                tempDiv.textContent = textBeforeCursor + '\n';
                document.body.appendChild(tempDiv);
                const cursorY = tempDiv.getBoundingClientRect().height;
                document.body.removeChild(tempDiv);
                const textareaRect = textarea.getBoundingClientRect();
                const offsetFromTop = textareaRect.top + window.scrollY;
                window.scrollTo({
                    top: offsetFromTop + cursorY - 50, // Mantém o cursor ~50px abaixo do topo
                    behavior: 'smooth'
                });
            });
        }

        function setupVideoDelay() {
            const btn = document.querySelector('[data-btn="video_inicial"]');
            const countdown = document.querySelector('[data-countdown="video_inicial"]');
            const video = document.querySelector('[data-video="video_inicial"]');
            const step = document.querySelector('.step[data-name="video_inicial"]');
            let timeLeft = DELAY_VIDEO_INICIAL;
            
            if (!ENABLE_DELAY) {
                btn.disabled = false;
                countdown.textContent = '';
                btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                return;
            }
            
            
            btn.disabled = true;
            
            const timer = setInterval(() => {
                countdown.textContent = `Botão liberado em ${timeLeft}s`;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                }
            }, 1000);

            // Opcional: acelerar se o vídeo for assistido
            video.addEventListener('ended', () => {
                if (timeLeft > 5) {
                    timeLeft = 5;
                }
            });
        }

        function setupVideoDelayNew() {
            const btn = document.querySelector('[data-btn="video_explicacao"]');
            const countdown = document.querySelector('[data-countdown="video_explicacao"]');
            const video = document.querySelector('.step[data-name="video_explicacao"] video');
            const step = document.querySelector('.step[data-name="video_explicacao"]');
            let timeLeft = DELAY_VIDEO_EXPLICACAO;
            
            if (!ENABLE_DELAY) {
                btn.disabled = false;
                countdown.textContent = '';
                btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                return;
            }
            
            
            btn.disabled = true;
            
            const timer = setInterval(() => {
                countdown.textContent = `Botão liberado em ${timeLeft}s`;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                }
            }, 1000);
            
            video.addEventListener('ended', () => {
                if (timeLeft > 5) {
                    timeLeft = 5;
                }
            });
            
            video.addEventListener('play', function() {
                this.muted = false;
            });
        }

        
        function setupVideoDelay2() {
            const btn = document.querySelector('[data-btn="depoimentos"]');
            const countdown = document.querySelector('[data-countdown="depoimentos"]');
            const video = document.querySelector('[data-video="depoimentos"]');
            const step = document.querySelector('.step[data-name="depoimentos"]');
            let timeLeft = DELAY_DEPOIMENTOS;
            
            if (!ENABLE_DELAY) {
                btn.disabled = false;
                countdown.textContent = '';
                btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                return;
            }

            
            btn.disabled = true;
            
            const timer = setInterval(() => {
                countdown.textContent = `Botão liberado em ${timeLeft}s`;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                }
            }, 1000);

            // Opcional: acelerar se o vídeo for assistido
            video.addEventListener('ended', () => {
                if (timeLeft > 5) {
                    timeLeft = 5;
                }
            });
        }

        function setupDelay(buttonId, countdownId, stepName) {
            const btn = document.querySelector(`[data-btn="${stepName}"]`);
            const countdown = document.querySelector(`[data-countdown="${stepName}"]`);
            const step = document.querySelector(`.step[data-name="${stepName}"]`);
            if (!btn) {
                console.error(`Erro: Botão ${buttonId} não encontrado`);
                return;
            }
            if (!countdown) {
                console.error(`Erro: Elemento ${countdownId} não encontrado`);
                return;
            }
            
            let timeLeft = DELAY_FAQ;
            
            if (!ENABLE_DELAY) {
                btn.disabled = false;
                countdown.textContent = '';
                btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                return;
            }
            btn.disabled = true;
            
            const timer = setInterval(() => {
                countdown.textContent = `Botão liberado em ${timeLeft}s`;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                }
            }, 1000);
        }

        // Inicializar
        updateStepIndicator();
        
        // Prevenir scroll horizontal
        document.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Scroll suave entre seções
        window.addEventListener('beforeunload', function() {
            window.scrollTo(0, 0);
        });

        function toggleScroll() {
            const body = document.body;
            const container = document.querySelector('.container');
            const footer = document.querySelector('.footer');
            const contentHeight = container.offsetHeight + footer.offsetHeight;
            const windowHeight = window.innerHeight;

            if (contentHeight <= windowHeight) {
                body.style.overflowY = 'hidden';
            } else {
                body.style.overflowY = 'auto';
            }
        }

        window.addEventListener('load', toggleScroll);
        window.addEventListener('resize', toggleScroll);

        function updateFooterPosition() {
            const container = document.querySelector('.container');
            const footer = document.querySelector('.footer');
            container.style.minHeight = `calc(100vh - ${footer.offsetHeight}px)`;
        }

        window.addEventListener('load', updateFooterPosition);
        window.addEventListener('resize', updateFooterPosition);

        document.querySelector('[data-video="video_explicacao"]').addEventListener('play', function() {
            this.muted = false;
        });

        document.querySelector('[data-video="video_inicial"]').addEventListener('play', function() {
            this.muted = false;
        });

        document.querySelector('[data-video="depoimentos"]').addEventListener('play', function() {
            this.muted = false;
        });

        getStepFromURL();
        window.addEventListener('hashchange', getStepFromURL);
        window.addEventListener('load', autoTest);


        function setupFormDelay() {
            const btn = document.querySelector('[data-btn="dados_pessoais"]');
            const countdown = document.querySelector('[data-countdown="dados_pessoais"]');
            const form = document.querySelector('[data-form="dados_pessoais"]');
            const inputs = form.querySelectorAll('input');
            
            btn.disabled = true;
            
            function validateForm() {
                const name = document.getElementById('nome').value.trim();
                const whatsapp = document.getElementById('whatsapp').value.trim();
                const age = document.getElementById('idade').value.trim();
                
                const nameRegex = /^[A-Za-zÀ-ÿ\s]{3,}$/;
                const whatsappRegex = /^\d{10,11}$/;
                
                let showError = false;
                
                // Verifica se há números no nome (quando o campo não está vazio)
                if (name && !nameRegex.test(name)) {
                    showError = true;
                }
                
                // Verifica se o WhatsApp é inválido (quando o campo não está vazio)
                if (whatsapp && !whatsappRegex.test(whatsapp)) {
                    showError = true;
                }
                
                // Verifica se a idade é menor que 40 ou tem 3 dígitos (quando o campo não está vazio)
                if (age && (parseInt(age) < 40 || parseInt(age) > 99)) {
                    showError = true;
                }
                
                const isValid = nameRegex.test(name) && whatsappRegex.test(whatsapp) && age >= 40;
                
                btn.disabled = !isValid;
                countdown.textContent = showError ? 'Preencha com dados válidos (nome e sobrenome: apenas letras, WhatsApp: 10-11 dígitos, idade: ≥40)' : '';
                
                if (isValid) {
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                }
            }
            
            inputs.forEach(input => input.addEventListener('input', validateForm));
            validateForm(); // Chama a validação inicial
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = {
                    nome: document.getElementById('nome').value,
                    whatsapp: document.getElementById('whatsapp').value,
                    idade: document.getElementById('idade').value
                };
                saveToSession('dados_pessoais', formData);
                nextStep();
            });
        }

        function setupLevelForm() {
            const btn = document.querySelector('[data-btn="nivel_violao"]');
            const countdown = document.querySelector('[data-countdown="nivel_violao"]');
            const form = document.querySelector('[data-form="nivel_violao"]');
            const customLevel = document.getElementById('nivelPersonalizado');
            const customLevelText = document.getElementById('textoNivelPersonalizado');
            const radios = form.querySelectorAll('input[name="nivel"]');
            
            btn.disabled = true;
            
            function checkForm() {
                const isSelected = Array.from(radios).some(radio => radio.checked);
                const isCustomValid = !customLevel.checked || (customLevel.checked && customLevelText.value.trim() !== '');
                if (isSelected && isCustomValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = customLevel.checked ? 'Descreva seu nível' : 'Selecione uma opção';
                }
            }
            
            radios.forEach(radio => radio.addEventListener('change', () => {
                customLevelText.style.display = radio.value === 'personalizado' ? 'block' : 'none';
                checkForm();
            }));
            
            customLevelText.addEventListener('input', () => {
                customLevelText.style.height = 'auto';
                customLevelText.style.height = `${customLevelText.scrollHeight}px`;
                checkForm();
            });

            scrollTextareaToTop(customLevelText);
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const levelData = {
                    nivel: form.querySelector('input[name="nivel"]:checked').value,
                    nivel_personalizado: customLevel.checked ? sanitizeInput(customLevelText.value) : ''
                };
                saveToSession('nivel_violao', levelData);
                nextStep();
            });
        }

        function setupMusicForm() {
            const btn = document.querySelector('[data-btn="tipo_musica"]');
            const countdown = document.querySelector('[data-countdown="tipo_musica"]');
            const form = document.querySelector('[data-form="tipo_musica"]');
            const radios = form.querySelectorAll('input[name="musica"]');
            const otherMusic = document.getElementById('outraMusica');
            const otherMusicText = document.getElementById('textoOutraMusica');
            
            btn.disabled = true;
            
            function checkForm() {
                const isSelected = Array.from(radios).some(radio => radio.checked);
                const isOtherValid = !otherMusic.checked || (otherMusic.checked && otherMusicText.value.trim() !== '');
                if (isSelected && isOtherValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = otherMusic.checked ? 'Especifique o tipo de música' : 'Selecione uma opção';
                }
            }
            
            radios.forEach(radio => radio.addEventListener('change', () => {
                otherMusicText.style.display = radio.value === 'outro' ? 'block' : 'none';
                checkForm();
            }));
            
            otherMusicText.addEventListener('input', checkForm);

            otherMusicText.addEventListener('input', () => {
                otherMusicText.style.height = 'auto';
                otherMusicText.style.height = `${otherMusicText.scrollHeight}px`;
            });
            scrollTextareaToTop(otherMusicText);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const musicData = {
                    musica: form.querySelector('input[name="musica"]:checked').value,
                    musica_personalizada: otherMusic.checked ? sanitizeInput(otherMusicText.value) : ''
                };
                saveToSession('tipo_musica', musicData);
                nextStep();
            });
        }

        function toggleVideo(videoName) {
            const videoContainer = document.querySelector(`[data-video="${videoName}"]`);
            if (!videoContainer) {
                console.error(`Erro: Contêiner de vídeo ${videoName} não encontrado`);
                return;
            }
            const label = Array.from(document.querySelectorAll('label')).find(l => 
                l.querySelector(`button[onclick="toggleVideo('${videoName}')"]`)
            );
            if (!label || !label.querySelector('button')) {
                console.error(`Erro: Label ou botão para o vídeo ${videoName} não encontrado`);
                return;
            }
            const button = label.querySelector('button');
            const triangle = button.querySelector('.triangle');
            const video = videoContainer.querySelector('video');
            if (!video) {
                console.error(`Erro: Vídeo ${videoName} não encontrado no contêiner`);
                return;
            }
            videoContainer.style.display = videoContainer.style.display === 'none' ? 'block' : 'none';
            if (videoContainer.style.display === 'none') {
                video.pause();
                video.currentTime = 0;
            }
            if (triangle) {
                triangle.className = videoContainer.style.display === 'block' ? 'triangle triangle-up' : 'triangle triangle-down';
            }
            button.textContent = videoContainer.style.display === 'block' ? 'Fechar vídeo ' : 'Ver ritmo ';
            if (triangle) {
                const newTriangle = document.createElement('span');
                newTriangle.className = videoContainer.style.display === 'block' ? 'triangle triangle-up' : 'triangle triangle-down';
                button.appendChild(newTriangle);
            }
        }

        function setupExtraForm15() {
            const btn = document.querySelector('[data-btn="informacoes_extras"]');
            const countdown = document.querySelector('[data-countdown="informacoes_extras"]');
            const form = document.querySelector('[data-form="informacoes_extras"]');
            const radios = form.querySelectorAll('input[name="extra"]');
            const extraYes = document.getElementById('extraSim');
            const extraText = document.getElementById('textoExtra');
            
            btn.disabled = true;
            
            function checkForm() {
                const isSelected = Array.from(radios).some(radio => radio.checked);
                const isYesValid = !extraYes.checked || (extraYes.checked && extraText.value.trim() !== '');
                if (isSelected && isYesValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = extraYes.checked ? 'Escreva sua informação' : 'Selecione uma opção';
                }
            }
            
            radios.forEach(radio => radio.addEventListener('change', () => {
                extraText.style.display = radio.value === 'sim' ? 'block' : 'none';
                checkForm();
            }));
            
            extraText.addEventListener('input', () => {
                extraText.style.height = 'auto';
                extraText.style.height = `${extraText.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(extraText);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const extraData = {
                    resposta: form.querySelector('input[name="extra"]:checked').value,
                    texto_extra: extraYes.checked ? sanitizeInput(extraText.value) : ''
                };
                saveToSession('informacoes_extras', extraData);
                nextStep();
            });
        }

        function setupChordForm() {
            const btn = document.querySelector('[data-btn="sabe_acorde"]');
            const countdown = document.querySelector('[data-countdown="sabe_acorde"]');
            const form = document.querySelector('[data-form="sabe_acorde"]');
            const sabeAcordeSim = document.getElementById('sabeAcordeSim');
            const acordesOptions = document.getElementById('acordesOptions');
            const acordePersonalizado = document.getElementById('acordePersonalizado');
            const textoAcordePersonalizado = document.getElementById('textoAcordePersonalizado');
            const radios = form.querySelectorAll('input[name="sabeAcorde"]');
            const tipoAcordeRadios = form.querySelectorAll('input[name="tipoAcorde"]');

            btn.disabled = true;

            function checkForm() {
                const isSabeAcordeSelected = Array.from(radios).some(radio => radio.checked);
                const isTipoAcordeValid = !sabeAcordeSim.checked || Array.from(tipoAcordeRadios).some(radio => radio.checked);
                const isCustomValid = !acordePersonalizado.checked || (acordePersonalizado.checked && textoAcordePersonalizado.value.trim() !== '');
                if (isSabeAcordeSelected && (!sabeAcordeSim.checked || (isTipoAcordeValid && isCustomValid))) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = sabeAcordeSim.checked ? (acordePersonalizado.checked ? 'Descreva os acordes' : 'Selecione uma opção de acorde') : 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', () => {
                acordesOptions.style.display = radio.value === 'sim' ? 'block' : 'none';
                checkForm();
            }));

            tipoAcordeRadios.forEach(radio => radio.addEventListener('change', () => {
                textoAcordePersonalizado.style.display = radio.value === 'personalizado' ? 'block' : 'none';
                checkForm();
            }));

            textoAcordePersonalizado.addEventListener('input', () => {
                textoAcordePersonalizado.style.height = 'auto';
                textoAcordePersonalizado.style.height = `${textoAcordePersonalizado.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(textoAcordePersonalizado);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const chordData = {
                    sabeAcorde: form.querySelector('input[name="sabeAcorde"]:checked').value,
                    tipoAcorde: sabeAcordeSim.checked ? form.querySelector('input[name="tipoAcorde"]:checked')?.value || '' : '',
                    acordePersonalizado: acordePersonalizado.checked ? sanitizeInput(textoAcordePersonalizado.value) : ''
                };
                saveToSession('sabe_acorde', chordData);
                nextStep();
            });
        }

        function setupTuneForm() {
            const btn = document.querySelector('[data-btn="sabe_afinar"]');
            const countdown = document.querySelector('[data-countdown="sabe_afinar"]');
            const form = document.querySelector('[data-form="sabe_afinar"]');
            const radios = form.querySelectorAll('input[name="sabeAfinar"]');

            btn.disabled = true;

            function checkForm() {
                if (Array.from(radios).some(radio => radio.checked)) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', checkForm));

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const tuneData = {
                    sabeAfinar: form.querySelector('input[name="sabeAfinar"]:checked').value
                };
                saveToSession('sabe_afinar', tuneData);
                nextStep();
            });
        }

        function setupRhythmForm() {
            const btn = document.querySelector('[data-btn="sabe_ritmo"]');
            const countdown = document.querySelector('[data-countdown="sabe_ritmo"]');
            const form = document.querySelector('[data-form="sabe_ritmo"]');
            const sabeRitmoSim = document.getElementById('sabeRitmoSim');
            const ritmosOptions = document.getElementById('ritmosOptions');
            const ritmoPersonalizado = document.getElementById('ritmoPersonalizado');
            const textoRitmoPersonalizado = document.getElementById('textoRitmoPersonalizado');
            const radios = form.querySelectorAll('input[name="sabeRitmo"]');
            const checkboxes = form.querySelectorAll('input[name="ritmo"]');
            const ritmoPersonalizadoRadio = form.querySelector('input[name="ritmoPersonalizado"]');

            btn.disabled = true;

            function checkForm() {
                const isSabeRitmoSelected = Array.from(radios).some(radio => radio.checked);
                let isValid = isSabeRitmoSelected;
                if (sabeRitmoSim.checked) {
                    const isRitmoChecked = Array.from(checkboxes).some(cb => cb.checked);
                    const isCustomValid = !ritmoPersonalizado.checked || (ritmoPersonalizado.checked && textoRitmoPersonalizado.value.trim() !== '');
                    isValid = isRitmoChecked || (ritmoPersonalizado.checked && isCustomValid);
                }
                if (isValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = sabeRitmoSim.checked ? (ritmoPersonalizado.checked ? 'Descreva os ritmos' : 'Selecione pelo menos um ritmo ou escreva') : 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', () => {
                ritmosOptions.style.display = radio.value === 'sim' ? 'block' : 'none';
                textoRitmoPersonalizado.style.display = 'none';
                ritmoPersonalizado.checked = false; // Desmarcar rádio personalizado ao mudar sabeRitmo
                checkForm();
            }));

            checkboxes.forEach(cb => cb.addEventListener('change', checkForm));

            ritmoPersonalizadoRadio.addEventListener('change', () => {
                textoRitmoPersonalizado.style.display = ritmoPersonalizado.checked ? 'block' : 'none';
                checkForm();
            });

            textoRitmoPersonalizado.addEventListener('input', () => {
                textoRitmoPersonalizado.style.height = 'auto';
                textoRitmoPersonalizado.style.height = `${textoRitmoPersonalizado.scrollHeight}px`;
                checkForm();
            });

            scrollTextareaToTop(textoRitmoPersonalizado);

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const ritmos = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
                const rhythmData = {
                    sabeRitmo: form.querySelector('input[name="sabeRitmo"]:checked').value,
                    ritmos: ritmos,
                    ritmoPersonalizado: ritmoPersonalizado.checked ? sanitizeInput(textoRitmoPersonalizado.value) : ''
                };
                saveToSession('sabe_ritmo', rhythmData);
                nextStep();
            });
        }

        function setupSongForm() {
            const btn = document.querySelector('[data-btn="sabe_musica"]');
            const countdown = document.querySelector('[data-countdown="sabe_musica"]');
            const form = document.querySelector('[data-form="sabe_musica"]');
            const sabeMusicaSim = form.querySelector('input[value="sim"]');
            const textoMusica = document.getElementById('textoMusica');
            const radios = form.querySelectorAll('input[name="sabeMusica"]');

            btn.disabled = true;

            function checkForm() {
                const isSelected = Array.from(radios).some(radio => radio.checked);
                const isTextValid = !sabeMusicaSim.checked || (sabeMusicaSim.checked && textoMusica.value.trim() !== '');
                if (isSelected && isTextValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = sabeMusicaSim.checked ? 'Descreva as músicas' : 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', () => {
                textoMusica.style.display = radio.value === 'sim' ? 'block' : 'none';
                checkForm();
            }));

            textoMusica.addEventListener('input', () => {
                textoMusica.style.height = 'auto';
                textoMusica.style.height = `${textoMusica.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(textoMusica);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const songData = {
                    sabeMusica: form.querySelector('input[name="sabeMusica"]:checked').value,
                    musicas: sabeMusicaSim.checked ? sanitizeInput(textoMusica.value) : ''
                };
                saveToSession('sabe_musica', songData);
                nextStep();
            });
        }

        function setupGoalForm() {
            const btn = document.querySelector('[data-btn="objetivo_violao"]');
            const countdown = document.querySelector('[data-countdown="objetivo_violao"]');
            const form = document.querySelector('[data-form="objetivo_violao"]');
            const objetivoOutro = document.getElementById('objetivoOutro');
            const textoObjetivo = document.getElementById('textoObjetivo');
            const radios = form.querySelectorAll('input[name="objetivo"]');

            btn.disabled = true;

            function checkForm() {
                const isSelected = Array.from(radios).some(radio => radio.checked);
                const isCustomValid = !objetivoOutro.checked || (objetivoOutro.checked && textoObjetivo.value.trim() !== '');
                if (isSelected && isCustomValid) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = objetivoOutro.checked ? 'Descreva seu objetivo' : 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', () => {
                textoObjetivo.style.display = radio.value === 'outro' ? 'block' : 'none';
                checkForm();
            }));

            textoObjetivo.addEventListener('input', () => {
                textoObjetivo.style.height = 'auto';
                textoObjetivo.style.height = `${textoObjetivo.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(textoObjetivo);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const goalData = {
                    objetivo: form.querySelector('input[name="objetivo"]:checked').value,
                    objetivoPersonalizado: objetivoOutro.checked ? sanitizeInput(textoObjetivo.value) : ''
                };
                saveToSession('objetivo_violao', goalData);
                nextStep();
            });
        }

        function setupDifficultyForm() {
            const btn = document.querySelector('[data-btn="dificuldade_violao"]');
            const countdown = document.querySelector('[data-countdown="dificuldade_violao"]');
            const form = document.querySelector('[data-form="dificuldade_violao"]');
            const textoDificuldade = document.getElementById('textoDificuldade');

            btn.disabled = true;

            function checkForm() {
                if (textoDificuldade.value.trim() !== '') {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = 'Escreva sua dificuldade';
                }
            }

            textoDificuldade.addEventListener('input', () => {
                textoDificuldade.style.height = 'auto';
                textoDificuldade.style.height = `${textoDificuldade.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(textoDificuldade);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const difficultyData = {
                    dificuldade: sanitizeInput(textoDificuldade.value)
                };
                saveToSession('dificuldade_violao', difficultyData);
                nextStep();
            });
        }

        function setupCallForm() {
            const btn = document.querySelector('[data-btn="videochamada"]');
            const countdown = document.querySelector('[data-countdown="videochamada"]');
            const form = document.querySelector('[data-form="videochamada"]');
            const radios = form.querySelectorAll('input[name="videochamada"]');

            btn.disabled = true;

            function checkForm() {
                if (Array.from(radios).some(radio => radio.checked)) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', checkForm));

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const callData = {
                    videochamada: form.querySelector('input[name="videochamada"]:checked').value
                };
                saveToSession('videochamada', callData);
                nextStep();
            });
        }

        function setupTrainingForm() {
            const btn = document.querySelector('[data-btn="disponibilidade_treino"]');
            const countdown = document.querySelector('[data-countdown="disponibilidade_treino"]');
            const form = document.querySelector('[data-form="disponibilidade_treino"]');
            const radios = form.querySelectorAll('input[name="disponibilidade"]');

            btn.disabled = true;

            function checkForm() {
                if (Array.from(radios).some(radio => radio.checked)) {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = 'Selecione uma opção';
                }
            }

            radios.forEach(radio => radio.addEventListener('change', checkForm));

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const trainingData = {
                    disponibilidade: form.querySelector('input[name="disponibilidade"]:checked').value
                };
                saveToSession('disponibilidade_treino', trainingData);
                nextStep();
            });
        }

        function setupWeeklyGoalForm() {
            const btn = document.querySelector('[data-btn="objetivo_semana"]');
            const countdown = document.querySelector('[data-countdown="objetivo_semana"]');
            const form = document.querySelector('[data-form="objetivo_semana"]');
            const textoObjetivoSemana = document.getElementById('textoObjetivoSemana');

            btn.disabled = true;

            function checkForm() {
                if (textoObjetivoSemana.value.trim() !== '') {
                    btn.disabled = false;
                    countdown.textContent = '';
                    btn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
                } else {
                    btn.disabled = true;
                    countdown.textContent = 'Escreva seu objetivo';
                }
            }

            textoObjetivoSemana.addEventListener('input', () => {
                textoObjetivoSemana.style.height = 'auto';
                textoObjetivoSemana.style.height = `${textoObjetivoSemana.scrollHeight}px`;
                checkForm();
            });
            scrollTextareaToTop(textoObjetivoSemana);
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const weeklyGoalData = {
                    objetivoSemana: sanitizeInput(textoObjetivoSemana.value)
                };
                saveToSession('objetivo_semana', weeklyGoalData);
                nextStep();
            });
        }

    </script>

    <script>
        const API_URL = 'https://lively-hall-dce9.suportegabriel7.workers.dev/inscricoes';

        // Inicializar sessionStorage
        function initSession() {
            if (!sessionStorage.getItem('formData')) {
                sessionStorage.setItem('formData', JSON.stringify({}));
            }
        }
        
        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        // Salvar dados na sessionStorage
        function saveToSession(key, value) {
            let formData = JSON.parse(sessionStorage.getItem('formData'));
            formData[key] = value;
            sessionStorage.setItem('formData', JSON.stringify(formData));
        }

        // Obter o próximo contador do Firebase
        async function getNextCounter() {
            try {
                const response = await fetch(API_URL);
                const result = await response.json();
                if (result.success && result.data) {
                    const counters = result.data
                        .filter(doc => doc.documentId && doc.documentId.startsWith('15diasgratis_'))
                        .map(doc => parseInt(doc.documentId.replace('15diasgratis_', '')))
                        .filter(n => !isNaN(n));
                    return counters.length > 0 ? Math.max(...counters) + 1 : 1;
                }
                return 1;
            } catch (error) {
                console.error('Erro ao obter contador:', error);
                return 1;
            }
        }

        // Sistema de envio mais robusto para Firebase
        class FormSubmissionManager {
            constructor() {
                this.maxRetries = 3;
                this.retryDelay = 2000; // 2 segundos
                this.isSubmitting = false;
                this.apiUrl = 'https://lively-hall-dce9.suportegabriel7.workers.dev/inscricoes';
            }

            // Enviar com sistema de retry
            async sendToFirebaseWithRetry() {
                if (this.isSubmitting) {
                    console.log('Envio já em andamento...');
                    return { success: false, error: 'Envio em andamento' };
                }

                this.isSubmitting = true;
                let lastError = null;

                for (let attempt = 1; attempt <= this.maxRetries; attempt++) {
                    try {
                        console.log(`Tentativa ${attempt}/${this.maxRetries} de envio...`);
                        
                        const result = await this.attemptSubmission();
                        
                        if (result.success) {
                            console.log('✅ Dados enviados com sucesso!');
                            this.clearFormData();
                            this.isSubmitting = false;
                            return result;
                        }
                        
                        lastError = result.error;
                        console.warn(`❌ Tentativa ${attempt} falhou:`, result.error);
                        
                    } catch (error) {
                        lastError = error.message;
                        console.error(`❌ Erro na tentativa ${attempt}:`, error);
                    }

                    // Aguardar antes da próxima tentativa (exceto na última)
                    if (attempt < this.maxRetries) {
                        console.log(`⏳ Aguardando ${this.retryDelay}ms antes da próxima tentativa...`);
                        await this.delay(this.retryDelay);
                        this.retryDelay *= 1.5; // Aumenta o delay progressivamente
                    }
                }

                this.isSubmitting = false;
                console.error('❌ Todas as tentativas falharam. Dados mantidos no storage.');
                
                // Salvar tentativa falhada para retry posterior
                this.saveFailedSubmission();
                
                return { 
                    success: false, 
                    error: `Falha após ${this.maxRetries} tentativas: ${lastError}`,
                    canRetry: true
                };
            }

            // Tentativa individual de envio
            async attemptSubmission() {
                const formData = JSON.parse(sessionStorage.getItem('formData') || '{}');
                
                if (Object.keys(formData).length === 0) {
                    throw new Error('Nenhum dado para enviar');
                }

          

                const counter = await this.getNextCounterWithRetry();
                const dataToSend = this.prepareDataForSubmission(formData, counter);

                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend)
                });

                if (!response.ok) {
                    const errorText = await response.text().catch(() => 'Erro desconhecido');
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Resposta de erro do servidor');
                }

                return result;
            }

            // Obter contador com retry
            async getNextCounterWithRetry() {
                for (let i = 0; i < 3; i++) {
                    try {
                        const response = await fetch(this.apiUrl);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        
                        const result = await response.json();
                        if (result.success && result.data) {
                            const counters = result.data
                                .filter(doc => doc.documentId?.startsWith('15diasgratis_'))
                                .map(doc => parseInt(doc.documentId.replace('15diasgratis_', '')))
                                .filter(n => !isNaN(n));
                            
                            return counters.length > 0 ? Math.max(...counters) + 1 : 1;
                        }
                    } catch (error) {
                        console.warn(`Erro ao obter contador (tentativa ${i + 1}):`, error);
                        if (i === 2) return Date.now(); // Fallback com timestamp
                    }
                }
                return 1;
            }

            // Preparar dados para envio
            prepareDataForSubmission(formData, counter) {
                return {
                    documentId: `15diasgratis_${counter}`,
                    step_times: JSON.stringify(stepTimes),
                    numero_inscricao: counter.toString(),
                    nome: formData.dados_pessoais?.nome || '',
                    whatsapp: formData.dados_pessoais?.whatsapp || '',
                    idade: formData.dados_pessoais?.idade || '',
                    nivel_violao: formData.nivel_violao?.nivel || '',
                    nivel_personalizado: formData.nivel_violao?.nivel_personalizado || '',
                    tipo_musica: formData.tipo_musica?.musica || '',
                    musica_personalizada: formData.tipo_musica?.musica_personalizada || '',
                    sabe_acorde: formData.sabe_acorde?.sabeAcorde || '',
                    tipo_acorde: formData.sabe_acorde?.tipoAcorde || '',
                    acorde_personalizado: formData.sabe_acorde?.acordePersonalizado || '',
                    sabe_afinar: formData.sabe_afinar?.sabeAfinar || '',
                    sabe_ritmo: formData.sabe_ritmo?.sabeRitmo || '',
                    ritmos: formData.sabe_ritmo?.ritmos || [],
                    ritmo_personalizado: formData.sabe_ritmo?.ritmoPersonalizado || '',
                    sabe_musica: formData.sabe_musica?.sabeMusica || '',
                    musicas: formData.sabe_musica?.musicas || '',
                    objetivo_violao: formData.objetivo_violao?.objetivo || '',
                    objetivo_personalizado: formData.objetivo_violao?.objetivoPersonalizado || '',
                    dificuldade_violao: formData.dificuldade_violao?.dificuldade || '',
                    videochamada: formData.videochamada?.videochamada || '',
                    objetivo_semana: formData.objetivo_semana?.objetivoSemana || '',
                    disponibilidade_treino: formData.disponibilidade_treino?.disponibilidade || '',
                    mais_informacoes: formData.informacoes_extras?.resposta || '',
                    texto_extra: formData.informacoes_extras?.texto_extra || '',
                    data_inscricao: new Date().toISOString(),
                    tipo: "inscricao"
                };
            }

            // Salvar tentativa falhada para retry posterior
            saveFailedSubmission() {
                const failedData = {
                    formData: sessionStorage.getItem('formData'),
                    stepTimes: sessionStorage.getItem('stepTimes'),
                    timestamp: Date.now(),
                    attempts: (JSON.parse(localStorage.getItem('failedSubmission') || '{}').attempts || 0) + 1
                };
                
                localStorage.setItem('failedSubmission', JSON.stringify(failedData));
                console.log('💾 Dados salvos para retry posterior');
            }

            // Tentar reenviar dados salvos
            async retryFailedSubmissions() {
                const failedData = localStorage.getItem('failedSubmission');
                if (!failedData) return;

                try {
                    const data = JSON.parse(failedData);
                    console.log('🔄 Tentando reenviar dados salvos...');
                    
                    // Restaurar dados temporariamente
                    if (data.formData) sessionStorage.setItem('formData', data.formData);
                    if (data.stepTimes) sessionStorage.setItem('stepTimes', data.stepTimes);
                    
                    const result = await this.sendToFirebaseWithRetry();
                    
                    if (result.success) {
                        localStorage.removeItem('failedSubmission');
                        console.log('✅ Dados anteriores reenviados com sucesso!');
                    }
                    
                } catch (error) {
                    console.error('❌ Erro ao reenviar dados salvos:', error);
                }
            }

            // Limpar dados após sucesso
            clearFormData() {
                sessionStorage.removeItem('formData');
                localStorage.removeItem('failedSubmission');
                console.log('🧹 Dados limpos após envio bem-sucedido');
            }

            // Utility: delay
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // Verificar se há dados pendentes
            hasPendingData() {
                return sessionStorage.getItem('formData') || localStorage.getItem('failedSubmission');
            }

            // Status da conexão
            isOnline() {
                return navigator.onLine;
            }
        }

        // Instanciar o gerenciador
        const submissionManager = new FormSubmissionManager();

        // Função principal para substituir a original
        async function sendToFirebase() {
            const result = await submissionManager.sendToFirebaseWithRetry();
            
            if (!result.success) {
                // Aqui você pode mostrar uma mensagem para o usuário
                console.error('Falha no envio:', result.error);
                // Opcional: mostrar toast/modal de erro
            }
            
            return result;
        }

        // Tentar reenviar dados ao carregar a página
        window.addEventListener('load', () => {
            if (submissionManager.hasPendingData()) {
                setTimeout(() => {
                    submissionManager.retryFailedSubmissions();
                }, 2000);
            }
        });

        // Tentar reenviar quando voltar online
        window.addEventListener('online', () => {
            console.log('🌐 Conexão restaurada, tentando reenviar dados...');
            if (submissionManager.hasPendingData()) {
                setTimeout(() => {
                    submissionManager.retryFailedSubmissions();
                }, 1000);
            }
        });

        // Capturar função de tempo da etapa final
        function captureStep19Time() {
            if (stepStartTime && currentStep === 'cadastro_final') {
                const endTime = Date.now();
                const timeSpent = USE_MILLISECONDS ? (endTime - stepStartTime) : Math.round((endTime - stepStartTime) / 1000);
                stepTimes[`tempo_${currentStep}`] = timeSpent;
                sessionStorage.setItem('stepTimes', JSON.stringify(stepTimes));
                console.log(`Tempo Etapa cadastro_final capturado: ${timeSpent}${USE_MILLISECONDS ? 'ms' : 's'}`);
            }
        }

        // Salvar tempos na sessionStorage
        function saveStepTimes() {
            console.log('Salvando tempos:', JSON.stringify(stepTimes, null, 2));
            sessionStorage.setItem('stepTimes', JSON.stringify(stepTimes));
        }

        // Iniciar sessionStorage
        // Tentar reenviar dados ao carregar a página
        window.addEventListener('load', () => {
            if (submissionManager.hasPendingData()) {
                setTimeout(() => {
                    submissionManager.retryFailedSubmissions();
                }, 2000);
            }
        });

        // Tentar reenviar quando voltar online
        window.addEventListener('online', () => {
            console.log('🌐 Conexão restaurada, tentando reenviar dados...');
            if (submissionManager.hasPendingData()) {
                setTimeout(() => {
                    submissionManager.retryFailedSubmissions();
                }, 1000);
            }
        });
        initSession();
    </script>

</body>

</html>
